(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const a=flarum.core.compat["admin/app"];var n=t.n(a);const r=flarum.core.compat["common/Model"];var s=t.n(r);const i=flarum.core.compat["common/models/User"];var o=t.n(i);function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}const c=flarum.core.compat["admin/components/ExtensionPage"];var u=t.n(c);const d=flarum.core.compat["tags/utils/sortTags"];var p=t.n(d);const g=flarum.core.compat["common/components/Alert"];var b=t.n(g);const v=flarum.core.compat["common/components/LinkButton"];var f=t.n(v);const h=flarum.core.compat["common/utils/ItemList"];var _=t.n(h),y=function(t){var e,a;function r(){return t.apply(this,arguments)||this}a=t,(e=r).prototype=Object.create(a.prototype),e.prototype.constructor=e,l(e,a);var s=r.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.refresh()},s.refresh=function(){n().store.find("tags",{include:"parent"}).then((function(){m.redraw()}))},s.isMailgunConfigured=function(){return"mailgun"!==this.setting("mail_driver")()},s.errorControls=function(){var t=new(_());return t.add("mailSettings",m(f(),{className:"Button Button--link",href:"/mail"},n().translator.trans("blomstra-email-conversations.admin.settings.alert.mail_settings")),50),t},s.content=function(){var t=this.isMailgunConfigured(),e=p()(n().store.all("tags")).filter((function(t){return null!==t.position()})).reduce((function(t,e){return t[e.slug()]=e.name()+" ("+e.slug()+")",t}),{"":n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag_none")});return m("div",{className:"EmailConversationsSettingsPage"},t&&m("div",{className:"EmailConversationsSettingsPage--alert"},m(b(),{type:"error",dismissible:!1,controls:this.errorControls().toArray()},n().translator.trans("blomstra-email-conversations.admin.settings.alert.mailgun_not_configured"))),m("div",{className:"container"},m("div",{className:"EmailConversations-content"},this.buildSettingComponent({setting:"blomstra-email-conversations.max-additional-emails-count",type:"number",min:0,max:100,label:n().translator.trans("blomstra-email-conversations.admin.settings.maximum_additional_emails_per_user"),help:n().translator.trans("blomstra-email-conversations.admin.settings.maximum_additional_emails_per_user_help"),placeholder:"5"}),this.buildSettingComponent({label:n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag"),help:n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag_help"),type:"select",setting:"blomstra-email-conversations.tag-slug",options:e,default:""}),this.buildSettingComponent({setting:"blomstra-email-conversations.auto-subscribe",type:"bool",label:n().translator.trans("blomstra-email-conversations.admin.settings.auto_subscribe"),help:n().translator.trans("blomstra-email-conversations.admin.settings.auto_subscribe_help")}),this.buildSettingComponent({setting:"blomstra-email-conversations.require_approval",type:"bool",label:n().translator.trans("blomstra-email-conversations.admin.settings.require_approval"),help:n().translator.trans("blomstra-email-conversations.admin.settings.require_approval_help")}),this.buildSettingComponent({setting:"blomstra-email-conversations.match_subject",label:n().translator.trans("blomstra-email-conversations.admin.settings.match_subject"),help:n().translator.trans("blomstra-email-conversations.admin.settings.match_subject_help"),type:"boolean"})),this.submitButton()))},r}(u());function S(){return S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},S.apply(this,arguments)}const C=flarum.core.compat["common/extend"],M=flarum.core.compat["admin/components/MailPage"];var P=t.n(M);const O=flarum.core.compat["common/components/LoadingIndicator"];var j=t.n(O);const x=flarum.core.compat["common/components/FieldSet"];var N=t.n(x);const B=flarum.core.compat["common/components/Button"];var E=t.n(B);n().initializers.add("blomstra/email-conversations",(function(){o().prototype.additionalEmails=s().hasMany("additional_emails"),P().prototype.mailItems=function(){var t=this,e=new(_()),a=this.driverFields[this.setting("mail_driver")()],r=Object.keys(a);return e.add("mail-from",this.buildSettingComponent({type:"text",setting:"mail_from",label:n().translator.trans("core.admin.email.addresses_heading")}),100),e.add("mail-driver",this.buildSettingComponent({type:"select",setting:"mail_driver",options:Object.keys(this.driverFields).reduce((function(t,e){var a;return S({},t,((a={})[e]=e,a))}),{}),label:n().translator.trans("core.admin.email.driver_heading")}),95),!this.status.sending&&e.add("sending-status",m(b(),{dismissible:!1},n().translator.trans("core.admin.email.not_sending_message")),90),r.length>0&&e.add("driver-settings",m(N(),{label:n().translator.trans("core.admin.email."+this.setting("mail_driver")()+"_heading"),className:"MailPage-MailSettings"},m("div",{className:"MailPage-MailSettings-input"},this.fieldKeyItems(a,r).toArray())),60),e.add("submit-button",this.submitButton(),10),e.add("send-test",m(N(),{label:n().translator.trans("core.admin.email.send_test_mail_heading"),className:"MailPage-MailSettings"},m("div",{className:"helpText"},n().translator.trans("core.admin.email.send_test_mail_text",{email:n().session.user.email()})),m(E(),{className:"Button Button--primary",disabled:this.sendingTest||this.isChanged(),onclick:function(){return t.sendTestEmail()}},n().translator.trans("core.admin.email.send_test_mail_button"))),0),e},P().prototype.fieldKeyItems=function(t,e){var a=this,r=new(_()),s=100;return e.map((function(e){var i=t[e];r.add("field-"+e,m("[",null,a.buildSettingComponent({type:"string"==typeof i?"text":"select",label:n().translator.trans("core.admin.email."+e+"_label"),setting:e,options:i}),a.status.errors[e]&&m("p",{className:"ValidationError"},a.status.errors[e])),s),s-=5})),r},(0,C.override)(P().prototype,"content",(function(t){return this.loading?m(j(),null):m("div",{className:"Form"},this.mailItems().toArray())})),(0,C.extend)(P().prototype,"mailItems",(function(t){var e=this;return void 0===this.route?t.add("create-route",m(E(),{className:"Button",onclick:function(){return e.configMailgunRoute()},loading:this.configuringRoute},n().translator.trans("blomstra-email-conversations.admin.email-page.mailgun.create-route")),5):t.add("route-info",m(N(),{label:n().translator.trans("blomstra-email-conversations.admin.email-page.mailgun.heading")},m("div",null,m("p",null,m("code",null,this.route.id)," - ",this.route.description))),5),t})),(0,C.override)(P().prototype,"refresh",(function(t){var e=this;this.loading=!0,this.status={sending:!1,errors:{}},n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/mail/settings"}).then((function(t){e.driverFields=t.data.attributes.fields,e.status.sending=t.data.attributes.sending,e.status.errors=t.data.attributes.errors,e.route=t.data.attributes.route,e.loading=!1,m.redraw()}))})),P().prototype.configMailgunRoute=function(){var t=this;this.configuringRoute=!0,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/mailgun/create/route",data:{}}).then((function(){t.configuringRoute=!1,t.refresh(),m.redraw()}))},n().extensionData.for("blomstra-email-conversations").registerPage(y).registerPermission({icon:"fas fa-mail-bulk",label:n().translator.trans("blomstra-email-conversations.admin.permissions.have_additional_emails"),permission:"haveAdditionalEmail"},"start")}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map