(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const a=flarum.core.compat["admin/app"];var n=t.n(a);const i=flarum.core.compat["common/Model"];var r=t.n(i);const o=flarum.core.compat["common/models/User"];var s=t.n(o);function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}const u=flarum.core.compat["admin/components/ExtensionPage"];var c=t.n(u);const d=flarum.core.compat["tags/utils/sortTags"];var p=t.n(d);const g=flarum.core.compat["common/components/Alert"];var f=t.n(g);const v=flarum.core.compat["common/components/LinkButton"];var b=t.n(v);const h=flarum.core.compat["common/utils/ItemList"];var _=t.n(h),y=function(t){var e,a;function i(){return t.apply(this,arguments)||this}a=t,(e=i).prototype=Object.create(a.prototype),e.prototype.constructor=e,l(e,a);var r=i.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.refresh()},r.refresh=function(){n().store.find("tags",{include:"parent"}).then((function(){m.redraw()}))},r.isMailgunConfigured=function(){return"mailgun"!==this.setting("mail_driver")()},r.errorControls=function(){var t=new(_());return t.add("mailSettings",m(b(),{className:"Button Button--link",href:"/mail"},n().translator.trans("blomstra-email-conversations.admin.settings.alert.mail_settings")),50),t},r.content=function(){var t=this.isMailgunConfigured(),e=p()(n().store.all("tags")).filter((function(t){return null!==t.position()})).reduce((function(t,e){return t[e.slug()]=e.name()+" ("+e.slug()+")",t}),{"":n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag_none")});return m("div",{className:"EmailConversationsSettingsPage"},t&&m("div",{className:"EmailConversationsSettingsPage--alert"},m(f(),{type:"error",dismissible:!1,controls:this.errorControls().toArray()},n().translator.trans("blomstra-email-conversations.admin.settings.alert.mailgun_not_configured"))),m("div",{className:"container"},m("div",{className:"EmailConversations-content"},this.buildSettingComponent({setting:"blomstra-email-conversations.max-additional-emails-count",type:"number",min:0,max:100,label:n().translator.trans("blomstra-email-conversations.admin.settings.maximum_additional_emails_per_user"),help:n().translator.trans("blomstra-email-conversations.admin.settings.maximum_additional_emails_per_user_help"),placeholder:"5"}),this.buildSettingComponent({label:n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag"),help:n().translator.trans("blomstra-email-conversations.admin.settings.email_post_tag_help"),type:"select",setting:"blomstra-email-conversations.tag-slug",options:e,default:""}),this.buildSettingComponent({setting:"blomstra-email-conversations.auto-subscribe",type:"bool",label:"Auto subscribe to discussions when posted via email",help:"Auto subscribe to discussions when posted via email"}),this.buildSettingComponent({setting:"blomstra-email-conversations.require_approval",type:"bool",label:"Require approval of new discussions started via email",help:"Require approval of new discussions started via email"})),this.submitButton()))},i}(c());function S(){return S=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},S.apply(this,arguments)}const M=flarum.core.compat["common/extend"],P=flarum.core.compat["admin/components/MailPage"];var C=t.n(P);const O=flarum.core.compat["common/components/LoadingIndicator"];var x=t.n(O);const N=flarum.core.compat["common/components/FieldSet"];var w=t.n(N);const j=flarum.core.compat["common/components/Button"];var B=t.n(j);n().initializers.add("blomstra/email-conversations",(function(){s().prototype.additionalEmails=r().hasMany("additional_emails"),C().prototype.mailItems=function(){var t=this,e=new(_()),a=this.driverFields[this.setting("mail_driver")()],i=Object.keys(a);return e.add("mail-from",this.buildSettingComponent({type:"text",setting:"mail_from",label:n().translator.trans("core.admin.email.addresses_heading")}),100),e.add("mail-driver",this.buildSettingComponent({type:"select",setting:"mail_driver",options:Object.keys(this.driverFields).reduce((function(t,e){var a;return S({},t,((a={})[e]=e,a))}),{}),label:n().translator.trans("core.admin.email.driver_heading")}),95),!this.status.sending&&e.add("sending-status",m(f(),{dismissible:!1},n().translator.trans("core.admin.email.not_sending_message")),90),i.length>0&&e.add("driver-settings",m(w(),{label:n().translator.trans("core.admin.email."+this.setting("mail_driver")()+"_heading"),className:"MailPage-MailSettings"},m("div",{className:"MailPage-MailSettings-input"},this.fieldKeyItems(a,i).toArray())),60),e.add("submit-button",this.submitButton(),10),e.add("send-test",m(w(),{label:n().translator.trans("core.admin.email.send_test_mail_heading"),className:"MailPage-MailSettings"},m("div",{className:"helpText"},n().translator.trans("core.admin.email.send_test_mail_text",{email:n().session.user.email()})),m(B(),{className:"Button Button--primary",disabled:this.sendingTest||this.isChanged(),onclick:function(){return t.sendTestEmail()}},n().translator.trans("core.admin.email.send_test_mail_button"))),0),e},C().prototype.fieldKeyItems=function(t,e){var a=this,i=new(_()),r=100;return e.map((function(e){var o=t[e];i.add("field-"+e,m("[",null,a.buildSettingComponent({type:"string"==typeof o?"text":"select",label:n().translator.trans("core.admin.email."+e+"_label"),setting:e,options:o}),a.status.errors[e]&&m("p",{className:"ValidationError"},a.status.errors[e])),r),r-=5})),i},(0,M.override)(C().prototype,"content",(function(t){return this.loading?m(x(),null):m("div",{className:"Form"},this.mailItems().toArray())})),(0,M.extend)(C().prototype,"mailItems",(function(t){var e=this;return void 0===this.route?t.add("create-route",m(B(),{className:"Button",onclick:function(){return e.configMailgunRoute()},loading:this.configuringRoute},n().translator.trans("blomstra-email-conversations.admin.email-page.mailgun.create-route")),5):t.add("route-info",m(w(),{label:n().translator.trans("blomstra-email-conversations.admin.email-page.mailgun.heading")},m("div",null,m("p",null,m("code",null,this.route.id)," - ",this.route.description))),5),t})),(0,M.override)(C().prototype,"refresh",(function(t){var e=this;this.loading=!0,this.status={sending:!1,errors:{}},n().request({method:"GET",url:n().forum.attribute("apiUrl")+"/mail/settings"}).then((function(t){e.driverFields=t.data.attributes.fields,e.status.sending=t.data.attributes.sending,e.status.errors=t.data.attributes.errors,e.route=t.data.attributes.route,e.loading=!1,m.redraw()}))})),C().prototype.configMailgunRoute=function(){var t=this;this.configuringRoute=!0,n().request({method:"POST",url:n().forum.attribute("apiUrl")+"/mailgun/create/route",data:{}}).then((function(){t.configuringRoute=!1,t.refresh(),m.redraw()}))},n().extensionData.for("blomstra-email-conversations").registerPage(y).registerPermission({icon:"fas fa-mail-bulk",label:n().translator.trans("blomstra-email-conversations.admin.permissions.have_additional_emails"),permission:"haveAdditionalEmail"},"start")}))})(),module.exports=e})();
//# sourceMappingURL=admin.js.map